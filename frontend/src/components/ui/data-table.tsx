"use client"

import { useState } from "react";
import {
  ColumnDef,
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  flexRender,
  getCoreRowModel,
  getFilteredRowModel,
  getSortedRowModel,
  useReactTable,
} from "@tanstack/react-table";

import { ScrollArea, ScrollBar } from "@/components/ui/scroll-area";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuCheckboxItem,
  DropdownMenuContent,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from "@/components/ui/table";

interface DataTableProps<TData, TValue> {
  columns: ColumnDef<TData, TValue>[]
  data: TData[]
}

export function DataTable<TData, TValue>({
  columns,
  data,
}: DataTableProps<TData, TValue>) {
  const [sorting, setSorting] = useState<SortingState>([]);
  const [columnFilters, setColumnFilters] = useState<ColumnFiltersState>([]);
  const [columnVisibility, setColumnVisibility] = useState<VisibilityState>({});

  const table = useReactTable({
    data,
    columns,
    getCoreRowModel: getCoreRowModel(),
    onSortingChange: setSorting,
    getSortedRowModel: getSortedRowModel(),
    onColumnFiltersChange: setColumnFilters,
    getFilteredRowModel: getFilteredRowModel(),
    onColumnVisibilityChange: setColumnVisibility,
    state: {
      sorting,
      columnFilters,
      columnVisibility,
    }
  })

  return (
    <div>
      <div className="flex items-center pb-4">
	<Input
	  placeholder="Search assignments..."
	  value={(table.getColumn("name")?.getFilterValue() as string) ?? ""}
	  onChange={(e) =>table.getColumn("name")?.setFilterValue(e.target.value)}
	  className="max-w-sm"
	/>
	<DropdownMenu>
	  <DropdownMenuTrigger asChild>
	    <Button variant="outline" className="ml-auto">
	      Columns
	    </Button>
	  </DropdownMenuTrigger>
	  <DropdownMenuContent align="end">
	    {
	      table
	      .getAllColumns()
	      .filter((column) => column.getCanHide())
	      .map((column) => (
		<DropdownMenuCheckboxItem
		  key={column.id}
		  className="capitalize"
		  checked={column.getIsVisible()}
		  onCheckedChange={(value) => column.toggleVisibility(!!value)}
		>
		  {column.id}
		</DropdownMenuCheckboxItem>
	      ))
	    }
	  </DropdownMenuContent>
	</DropdownMenu>
      </div>
      <ScrollArea className="whitespace-nowrap">
	<div className="overflow-hidden rounded-md">
	  <Table>
	    <TableHeader>
	      {table.getHeaderGroups().map((headerGroup) => (
		<TableRow key={headerGroup.id}>
		  {headerGroup.headers.map((header) => {
		    return (
		      <TableHead key={header.id}>
			{header.isPlaceholder
			  ? null
			  : flexRender(
			    header.column.columnDef.header,
			    header.getContext()
			  )}
		      </TableHead>
		    )
		  })}
		</TableRow>
	      ))}
	    </TableHeader>
	    <TableBody>
	      {table.getRowModel().rows?.length ? (
		table.getRowModel().rows.map((row) => (
		  <TableRow
		    key={row.id}
		    data-state={row.getIsSelected() && "selected"}
		  >
		    {row.getVisibleCells().map((cell) => (
		      <TableCell key={cell.id}>
			{flexRender(cell.column.columnDef.cell, cell.getContext())}
		      </TableCell>
		    ))}
		  </TableRow>
		))
	      ) : (
		  <TableRow>
		    <TableCell colSpan={columns.length} className="h-24 text-center">
		      No results.
		    </TableCell>
		  </TableRow>
		)}
	    </TableBody>
	  </Table>
	</div>
	<ScrollBar orientation="horizontal" />
      </ScrollArea>
    </div>
  )
}
